<!-- livebook:{"persist_outputs":true} -->

# Test

## Introduction

This notebook provides some tests to check that the integration between Livebook and the Wargame Tool client is working correctly.

## Connection with the Elixir Runtime

Run the cell bellow to check the connection with the Elixir runtime:

```elixir
1 + 1
```

<!-- livebook:{"output":true} -->

```
2
```

## Context Information

The following cell outputs the current EthClient context:

```elixir
EthClient.Context.all()
```

<!-- livebook:{"output":true} -->

```
%{
  chain_id: 4,
  contract: %EthClient.Contract{address: nil, functions: nil},
  etherscan_api_key: "your_eth_scan_api_key",
  infura_api_key: "your_infura_api_key",
  rpc_host: "https://rinkeby.infura.io/v3/your_infura_api_key",
  user_account: %EthClient.Account{
    address: "0xafb72ccaeb7e22c8a7640f605824b0898424b3da",
    private_key: "e90d75baafee04b3d9941bd8d76abe799b391aec596515dee11a9bd55f05709c"
  }
}
```

## Checking connection with the Local Ethereum DevNet

```elixir
defmodule EthereumChainConnectionTest do
  @headers [{"content-type", "application/json"}]
  @block_number_request_body %{jsonrpc: "2.0", method: "eth_blockNumber", params: [], id: 83}

  def test!(jsonrpc_url) do
    body = Jason.encode!(@block_number_request_body)
    {:ok, res} = Tesla.post(jsonrpc_url, body, headers: @headers)
    %Tesla.Env{body: body, status: 200} = res
    %{"result" => last_block_number} = Jason.decode!(body)

    IO.puts("Current block number for #{jsonrpc_url} is #{last_block_number}")

    last_block_number
  end
end

EthereumChainConnectionTest.test!("http://ethereum:8545")
EthereumChainConnectionTest.test!("http://ethereum:8546")
```

<!-- livebook:{"output":true} -->

```
Current block number for http://ethereum:8545 is 0x4
Current block number for http://ethereum:8546 is 0x405
```

<!-- livebook:{"output":true} -->

```
"0x405"
```

## Contract deployment

```elixir
EthClient.deploy(bin_path)
```

<!-- livebook:{"output":true} -->

```
warning: variable "bin_path" does not exist and is being expanded to "bin_path()", please use parentheses to remove the ambiguity or change the variable name
  /home/livebook/livebook-test.livemd#cell:1

```
